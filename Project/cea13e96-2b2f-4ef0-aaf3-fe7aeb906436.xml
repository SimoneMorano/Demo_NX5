<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>//FB name: Ax_InData&#xD;
&#xD;
//Revision: V1.08&#xD;
//Library: OneS_Positioning&#xD;
//Namespace: OMR_CH_PP_Pos&#xD;
//Autor: UN 28.11.16&#xD;
// Changes:&#xD;
// V1.08  Status.Homing  corrected&#xD;
//			   Status.Home removed&#xD;
// 				Added Axis.Details.Homed handling&#xD;
//				Added IncrementalMode input, and Present_motor_velocity input&#xD;
&#xD;
// Function: Power the servo motor&#xD;
// Input/Output:&#xD;
//		AxisData [OMR_CHPP_Pos\sPP_Axis]&#xD;
// Input: &#xD;
//		Enable [BOOL]&#xD;
//		NodeAdress [UINT]   EtherCAT node adress of drive&#xD;
//		Statusword [WORD]  Statusword of 1S drive&#xD;
//		Modes_of_operation_display [SINT]  Modes_of_operation_display of 1S drive&#xD;
//		Position_actual_value [DINT]  Position_actual_value of 1S drive&#xD;
//		Velocity_actual_value [DINT]  Velocity_actual_value of 1S drive&#xD;
//		Torque_actual_value [INT]  Torque_actual_value of 1S drive&#xD;
//		Present_motor_velocity [DINT]  Present_motor_velocity in RPM of 1S drive&#xD;
//		IncrementalMode [INT]  TRUE if Servo is set to use as incremental encoder, false if absolute encoder is used&#xD;
&#xD;
&#xD;
// Output:&#xD;
//		Busy [BOOL]  &#xD;
//		ErrorID [UINT] failure numbers of PP_Positioning are used.  &#xD;
//		Error [BOOL]  error appeared&#xD;
&#xD;
&#xD;
IF Enable THEN&#xD;
	AxisData.Cfg.NodeAddress := NodeAddress;&#xD;
	AxisData.StatusWord := Statusword;&#xD;
	AxisData.ModeOfOperationDisplay := Modes_of_operation_display;&#xD;
	AxisData.Position_actual_value := Position_actual_value;&#xD;
	AxisData.Act.Vel := Velocity_actual_value;&#xD;
	AxisData.Act.Trq := Torque_actual_value;&#xD;
	dint_AxisPosAndHomeOffset:= Position_actual_value+AxisData.HomeOffset;		//V1.07 02.10.2017&#xD;
	AxisData.Act.Pos :=DINT_TO_LREAL(dint_AxisPosAndHomeOffset);	//V1.07 S 02.10.2017      add home offset to act pos&#xD;
	AxisData.Act.VelRpm := Present_motor_velocity;&#xD;
	IF P_First_Run AND IncrementalMode THEN  // V1.08 in incremental mode, delete homed flag after boot up&#xD;
		AxisData.HomeOffset := 0;&#xD;
		AxisData.Details.Homed := FALSE;&#xD;
	END_IF;&#xD;
&#xD;
&#xD;
	//Clear(AxisData.Status);&#xD;
	Clear(AxisData.DrvStatus);&#xD;
	IF ((AxisData.StatusWord AND WORD#16#007F) = WORD#2#0001_0000 ) OR ( (AxisData.StatusWord AND WORD#16#007F) = WORD#2#0111_0000) THEN&#xD;
		AxisData.DrvStatus.MainPower:=TRUE;&#xD;
		AxisData.DrvStatus.ServoOn:=FALSE;&#xD;
		AxisData.DrvStatus.DrvAlarm := FALSE;&#xD;
		AxisData.DrvStatus.Ready := TRUE;&#xD;
			AxisData.Status.Ready := FALSE;&#xD;
	ELSIF  ( (AxisData.StatusWord AND WORD#16#006F) = WORD#2#0010_0111 ) THEN // x01x_0111 = OperationEnabled&#xD;
		AxisData.DrvStatus.ServoOn:=TRUE;&#xD;
		AxisData.DrvStatus.MainPower:=TRUE;&#xD;
		AxisData.DrvStatus.Ready:=TRUE;&#xD;
		AxisData.DrvStatus.DrvAlarm := FALSE;&#xD;
		AxisData.Status.Ready := TRUE;&#xD;
	ELSIF  ( (AxisData.StatusWord AND WORD#16#006F) = WORD#2#0000_0111 ) THEN // x00x_0111 = QuickStopActive&#xD;
		AxisData.DrvStatus.MainPower:=TRUE;&#xD;
		AxisData.DrvStatus.ServoOn:=TRUE;&#xD;
		AxisData.DrvStatus.Ready:=TRUE;&#xD;
	ELSIF  ( (AxisData.StatusWord AND WORD#16#004F) = WORD#2#0000_1111 ) THEN // x0xx_1111 = FaultReactionActive&#xD;
		AxisData.DrvStatus.MainPower:=TRUE;&#xD;
		AxisData.DrvStatus.ServoOn:=TRUE;&#xD;
		AxisData.DrvStatus.DrvAlarm := TRUE;&#xD;
			AxisData.Status.Ready := FALSE;&#xD;
	ELSIF ( (AxisData.StatusWord AND WORD#16#004F) = WORD#2#0000_1000 ) THEN // x0xx_1000 = Fault&#xD;
		AxisData.DrvStatus.DrvAlarm := TRUE;&#xD;
			AxisData.Status.Ready := FALSE;&#xD;
	END_IF;&#xD;
&#xD;
	AxisData.Status.Standstill :=  ((Modes_of_operation_display = SINT#3) AND ((Statusword AND WORD#2#0001_0000_0000_0000) = WORD#2#0001_0000_0000_0000))&#xD;
																OR ((Modes_of_operation_display = SINT#1) AND ((Statusword AND WORD#2#0000_0100_0000_0000) = WORD#2#0000_0100_0000_0000))&#xD;
																;&#xD;
																&#xD;
	AxisData.Status.Homing := ((Modes_of_operation_display = SINT#6) AND ((Statusword AND WORD#2#0011_0100_0000_0000) = WORD#2#0000_0000_0000_0000)) OR AxisData.Details.HomeInProgress;&#xD;
END_IF;&#xD;
</Text></StructuredTextModel>